분리된 시스템 간의 비동기 연동은 시스템 간 결합도를 낮출 수 있고, <span style="color: #3498db;">호출된 시스템의 응답을 기다리지 않기 때문에</span> 사용자 요청을 빠르게 응답할 수 있다는 장점이 있다.

이때 비동기 연동 방식으로 자주 사용되는 방식이 
1. `메시징 시스템 활용`
2. `데이터 베이스 활용`
3. `CDC 활용`

등이 있다.

각각의 방식들에 대해 포스팅한다.

---

# 1️⃣ 메시징 시스템 활용 방식

두 시스템 사이에 메시징 시스템을 두고 비동기로 연동하는 방식으로, 한 시스템에서 메시지를 생성한 뒤 이를 메시징 시스템(큐)에 송신한다.

다른 시스템에서 메시징 큐로부터 메시지를 읽어와 메시지를 처리한다.

주로 Kafka, RabbitMQ가 메시징 시스템으로 활용된다.

> 메시징 시스템 활용 방식은 처리량이 높은 것이 장점이다.
하지만, 메시지 손실, 메시지 소비 순서, 트랜잭션에 대한 추가적인 고려가 필요하다.

💡메시지 손실, 메시지 처리 순서는 알겠는데, 트랜잭션은 어떠한 추가 고려가 필요할까❓

1개의 트랜잭션 내에 메시지 전송과 데이터베이스 삽입이 존재한다고 가정하자.

데이터 베이스 삽입이 실패했는데 메시지는 전송되거나, 혹은 그 반대 상황이 발생할 수 있다.

이렇게 두 개 이상의 작업을 원자적(amotic)으로 처리하는 로직을 구현해야 한다.

---

# 2️⃣ 데이터베이스 활용 방식(Outbox Pattern)
데이터베이스를 메시징 시스템처럼 활용하는 방식으로, 한 시스템에서 데이터베이스 테이블에 필요한 메시지 레코드를 추가한 뒤 연동 시스템이 테이블을 주기적으로 읽는 방식`(Polling)`이다.

만약 새로운 메시지가 추가되면 연동 시스템은 다른 시스템으로 메시지를 전송한다. ( A <-> 연동 시스템 <-> B )

* 중간 매개 역할을 하는 연동 시스템이 A가 작성한 메시지 레코드를 데이터베이스에서 주기적으로 조회하며, 메시지가 추가되면 B 시스템으로 전달해줌을 의미

> 데이터베이스 활용 방식은 트랜잭션과 메시지 순서가 보장되며, 메시지 유실에 대한 걱정이 없다는 것이 장점이다.
하지만, 범용성이 떨어질 수 있다.

메시지에 대한 형식이 빈번히 변경될 때마다 메시지 레코드에 대한 스키마도 변경해줘야 하기 때문

또, <span style="color: #3498db;">삭제 정책과 읽기 빈도</span> 등 추가 고려사항도 존재한다.

---

# 3️⃣ CDC(Change Data Capture)

CDC는 데이터베이스의 변경 사항을 조회한 뒤 이를 다른 시스템에 전파하는 방식이다.

가령 별도의 시스템이 변경 감지 대상 데이터베이스의 바이너리 로그를 조회하여 변경을 전파하도록 구현할 수 있다.

> CDC 방식은 트랜잭션이 보장되며, 메시지를 생성하거나 별도로 저장할 필요가 없어 상대적으로 애플리케이션 로직이 단순하다는 장점이 있다.
하지만 <span style="color: #3498db;">변경 로그만 제공되고, 변경 이유에 대한 설명이 없어 </span>사용에 제약이 있을 수 있다.

💡데이터베이스 활용 방식과 다른 점이 뭐지❓
Outbox 패턴(데이터베이스 활용)은 애플리케이션이 메시지를 별도 테이블에 직접 저장하고, 연동 시스템이 이를 주기적으로 조회하여 처리하는 방식으로, 트랜잭션 일관성과 제어가 쉽지만 실시간성이 낮다. (Polling 시간이 있기 때문)

반면 CDC 방식은 데이터베이스의 변경 로그를 분석해 자동으로 이벤트를 감지하여 실시간성이 뛰어나지만 도입 복잡도과 제어 난이도가 높다는 차이가 있다.

> 즉, 데이터베이스 활용 방식은 Polling 방식이고
CDC 방식은 실시간 서비스 방식이다.
