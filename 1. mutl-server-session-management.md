# 0️⃣목차
> 
1. [세션 불일치 문제](#1)
2. [해결 방법](#2)
	2-1) [스티키 세션 방식](#3)
    2-2) [세션 클러스터링 방식](#4)
    2-3) [스토리지 분리 방식](#5)



# <div id=1>1️⃣세션 불일치 문제</div>
세션 인증은 클라이언트가 서버로 요청을 했을 때,
클라이언트에 대한 (로그인)정보를 서버 측에서 저장하고 이후 저장된 정보를 이용해 인증을 수행하는 방식이다.

그런데 다중 서버를 운영 중일 때
1. 처음에 A 서버에 요청을 하여 `A 서버에 세션 토큰이 생성`되었는데
2. 이후 로드 밸런서 등으로 인해 `다른 B 서버`에 요청이 될 경우 해당 사용자의 토큰이 서버에 등록되어 있지 않기 때문에 요청이 반려되거나 정상적으로 처리되지 않게 된다.

**💡이러한 문제를 `세션 불일치 문제`라고 한다.
**
# <div id=2>2️⃣해결 방법</div>
> 세션 불일치 문제를 해결할 수 있는 세 가지 방법에 대해 소개한다.

## <div id=3> ✅1. 스티키 세션 방식</div>

`스티키 세션 방식`(Sticky Session)은, 사용자 요청이 항상 사용자 세션 정보가 저장된 서버로 가도록 ‘고정’하는 방식이다.
- 즉, 해당 사용자 요청이 항상 동일한 서버로 전달되도록 한다.

사용자 요청의 쿠키나 IP를 통해서 어느 서버로 고정 시킬지 결정한다.

스티키 세션은 단순하고 구현이 쉽다는 장점이 있지만, **특정 서버에 트래픽이 집중**될 수 있고, 사용자의 세션 정보를 갖고 있는 **서버가 다운**되면 사용자는 로그인을 다시 해야 되는 문제점이 있다.

![](https://velog.velcdn.com/images/alstjr971/post/ca4b5f26-adac-4926-a309-625a574d753d/image.png)


---

## <div id=4> ✅2. 세션 클러스터링 방식</div>
스티키 세션 방식을 사용하면 해당 사용자의 정보를 저장한 서버가 다운됐을 경우, 다른 서버는 그 정보를 갖고 있지 않기 때문에 사용자는 다시 로그인해야 한다.

`세션 클러스터링 방식`은 특정 서버에 사용자 세션 정보가 생성될 때, 다른 서버로 세션 정보를 복제하는 방식이다.

여러 서버에 세션 정보를 중복으로 저장하므로 스티키 세션의 트래픽 몰림 현상과 세션 정보 유실 문제를 해결한다는 장점이 있다.

하지만, 세션 정보를 `중복`으로 저장하기 때문에 `메모리를 비효율적`으로 사용하며, 세션 정보 복제 과정에서 발생하는 `네트워크 트래픽 문제`, `세션 정보 복제 지연`으로 인한 일시적 `세션 유실 문제`가 발생할 수 있다.

![](https://velog.velcdn.com/images/alstjr971/post/d179cd91-f26d-413a-86b0-75bfa9d5cdce/image.png)

---

## <div id=5> ✅3. 스토리지 분리 방식</div>

`스토리지 분리 방식`은, 세션 정보를 저장하는 공간을 외부로 분리하는 방식이다.
세션 정보를 외부에 분리해 관리하기 때문에 스티키 세션 방식에서 발생하는 트래픽 몰림 현상과 세션 클러스터링 문제에서 발생하는 메모리 비효율 문제를 해결할 수 있다.

하지만 스토리지에 대한 단일 장애 지점이 문제가 될 수 있으며, 클러스터링과 같은 HA 구성으로 단일 장애 지점을 해소하여도 복제 지연으로 인한 일시적인 세션 정보 유실 문제는 발생할 수 있다.

또한, 외부 스토리지를 관리하기 위한 추가적인 리소스가 요구될 수 있다.

![](https://velog.velcdn.com/images/alstjr971/post/db17242b-7ba0-4937-8cbb-f3577c4d0c5a/image.png)

스토리지 분리 방식은 새로운 서버를 띄우더라도 해당 서버에만 세션 서버의 정보를 적어주고 연결 해주면 되기 때문에 scale out 할 때 기존 서버의 수정이 발생하지 않는다는 장점이 있다.

대신 Redis Session 서버의 중요성이 올라가고, 해당 세션 서버가 죽는 순간 모든 세션이 사라지기 때문에 이 Redis 서버의 다중화도 고려해보아야 할 점이다. (사용해 본 적은 없지만 Redis가 Replication 설정이 쉽다고 한다.)
